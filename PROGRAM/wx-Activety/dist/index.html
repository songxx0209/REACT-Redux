<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
    <meta charset="utf-8">
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    <title>微信投票活动</title>
</head>

<body>
    </div>
    <script type="text/javascript">
    (function() {
        //存储code的值
        var urlParams = _GetUrlParams();
        var code = urlParams.code || false;
        if (code) { //如果url中有code，将其存入本地缓存，清空search;code就等于url中的code
             localStorage.setItem('code', code);
             window.location.href = 'http://weixin.handsight.cn/vote/vote.html';
        } else { //如果url中没有code，就到本地缓存中去找，找到或没找到的情况
            var sessionId = localStorage.getItem("sessionId") || false;
            if (sessionId) {
                window.location.href = 'http://weixin.handsight.cn/vote/vote.html';
            } else {
                window.location.href = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxc10b385bc9169aa6&redirect_uri=http://weixin.handsight.cn/vote/index.html&response_type=code&scope=snsapi_userinfo&state=#wechat_redirect';
            }
        }
       
        function _GetUrlParams() {
            var url = location.search; //获取url中"?"符后的字串
            var theRequest = {};
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for (var i = 0; i < strs.length; i++) {
                    theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }
    })();
    </script>
</body>

</html>
